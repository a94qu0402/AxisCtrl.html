<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XY-Table Setup</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: "Microsoft Sans Serif", sans-serif;
      font-size: 15px;
      padding: 20px;
    }

    .dialog {
      max-width: 1200px;
      margin: 0 auto;
      border: 1px solid #aaa;
      padding: 20px;
    }

    .header {
      font-weight: bold;
      margin-bottom: 20px;
      font-size: 1.45rem;
    }

    .axis-panel {
      flex: 1;
      min-width: 300px;
      border: 1px solid #000;
      padding: 15px;
      max-height: 400px;
      overflow-y: auto;
    }

    .right-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
      height: 400px;
    }

    .groupbox {
      border: 1px solid #ccc;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 4px;
    }

    .flex-fill {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .field {
      margin-bottom: 10px;
    }

    .field span {
      display: inline-block;
      width: 180px;
      margin-right: 10px;
    }

    select.form-select,
    input.form-control {
      display: inline-block;
      width: auto;
      font-size: 15px;
      height: 30px;
      padding-top: 2px;
      padding-bottom: 2px;
    }

    input[type="text"].short {
      width: 70px;
    }

    @media (max-width: 768px) {
      .axis-panel {
        flex: 100%;
      }

      .field span {
        width: 100%;
        margin-bottom: 5px;
      }

      select.form-select,
      input.form-control {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="dialog">
    <div class="header">X 軸-Y 軸設定</div>

    <!-- 軸選擇 -->
    <div class="axis-selector mb-3">
      <label class="me-3"><input type="checkbox" class="form-check-input" name="axis" value="X" checked> X 軸</label>
      <label class="me-3"><input type="checkbox" class="form-check-input" name="axis" value="Y"> Y 軸</label>
      <label class="me-3"><input type="checkbox" class="form-check-input" name="axis" value="Z"> Z 軸</label>
      <label class="me-3"><input type="checkbox" class="form-check-input" name="axis" value="R"> R 軸</label>
    </div>

    <!-- 主內容 -->
    <div class="d-flex" style="align-items: stretch;">
      <!-- 左側 -->
      <div class="axis-panel me-3">
        <div class="field"><span>軸單位</span><select class="form-select"><option>公厘</option><option>度</option></select></div>
        <div class="field"><span>程式原點 [公厘]</span><input type="text" class="form-control" value="0" /></div>
        <div class="field"><span>編碼器程式原點 [公厘]</span><input type="text" class="form-control" value="0" /></div>
        <div class="field"><span>軸單位 [脈衝/公厘]</span><input type="text" class="form-control" value="5000" /></div>
        <div class="field"><span>編碼器單位 [脈衝/公厘]</span><input type="text" class="form-control" value="5000" /></div>
        <div class="field"><span>速度 [公厘/秒]</span><input type="text" class="form-control" value="100" /></div>
        <div class="field"><span>背隙 [公厘]</span><input type="text" class="form-control" value="0" /></div>
        <div class="field"><span>馬達反向</span><input type="checkbox" class="form-check-input" /></div>
        <div class="field"><span>吋動反向</span><input type="checkbox" class="form-check-input" /></div>
        <div class="field"><span>編碼器反向</span><input type="checkbox" class="form-check-input" /></div>
      </div>

      <!-- 右側 -->
      <div class="right-panel">
        <div class="groupbox flex-fill">
          <div class="field"><span>補償表：</span>
            <select class="form-select">
              <option>未使用</option>
              <option>載入補償表(txt)</option>
              <option>載入補償表(rxl)</option>
            </select>
          </div>
          <div class="field"><span>編碼器補償表：</span>
            <select class="form-select">
              <option>未使用</option>
              <option>載入補償表(txt)</option>
            </select>
          </div>
        </div>

        <div class="groupbox flex-fill">
          <div class="field"><span>速度範圍：</span>
            <input type="text" class="form-control short" value="1.0" /> ~ 
            <input type="text" class="form-control short" value="200.0" /> %
          </div>
          <div class="field"><span>工作結束點：</span>
            <select class="form-select">
              <option>無</option>
              <option>P0</option><option>P1</option><option>P2</option>
              <option>P3</option><option>P4</option><option>P5</option>
              <option>P6</option><option>P7</option><option>P8</option><option>P9</option>
            </select>
          </div>
          <div class="field"><span>原點回歸結束點：</span>
            <select class="form-select">
              <option>無</option>
              <option>P0</option><option>P1</option><option>P2</option>
              <option>P3</option><option>P4</option><option>P5</option>
              <option>P6</option><option>P7</option><option>P8</option><option>P9</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- 按鈕 -->
    <div class="text-center mt-4">
      <button type="button" class="btn btn-secondary btn-lg">套用</button>
    </div>
  </div>
</body>
</html>




    <script>
      // 儲存各軸參數的對象
      const axisParams = {
        X: {
          axisUnit: '公厘',
          programOrigin: '0',
          encoderProgramOrigin: '0',
          axisPulseUnit: '5000',
          encoderPulseUnit: '5000',
          speed: '100',
          backlash: '0',
          motorReverse: false,
          jogReverse: false,
          encoderReverse: false,
          limitLevel: '0',
          homeLevel: '0',
          indexLevel: '0',
          positionLevel: '0',
          accelTime: '0.1',
          accelMode: '梯形',
          initialSpeed: '0',
          posTimeout: '0',
          posDelay: '0',
          indexDelay: '0',
          externalHome: '無',
          externalPosJog: '無',
          externalNegJog: '無',
          homeSpeed: '50',
          leaveHomeSpeed: '25',
          homeReverse: false,
          homeLimitMode: '0',
          indexDirection: '不使用',
          limitStopMode: '0',
          homeOffset: '0',
          useSoftLimit: false,
          posLimit: '0',
          negLimit: '0',
          travel: '100',
          p0: '0', p1: '0', p2: '0', p3: '0', p4: '0',
          p5: '0', p6: '0', p7: '0', p8: '0', p9: '0',
          _isSelected: false
        },
        Y: {
          axisUnit: '公厘',
          programOrigin: '0',
          encoderProgramOrigin: '0',
          axisPulseUnit: '5000',
          encoderPulseUnit: '5000',
          speed: '100',
          backlash: '0',
          motorReverse: false,
          jogReverse: false,
          encoderReverse: false,
          limitLevel: '0',
          homeLevel: '0',
          indexLevel: '0',
          positionLevel: '0',
          accelTime: '0.1',
          accelMode: '梯形',
          initialSpeed: '0',
          posTimeout: '0',
          posDelay: '0',
          indexDelay: '0',
          externalHome: '無',
          externalPosJog: '無',
          externalNegJog: '無',
          homeSpeed: '50',
          leaveHomeSpeed: '25',
          homeReverse: false,
          homeLimitMode: '0',
          indexDirection: '不使用',
          limitStopMode: '0',
          homeOffset: '0',
          useSoftLimit: false,
          posLimit: '0',
          negLimit: '0',
          travel: '100',
          p0: '0', p1: '0', p2: '0', p3: '0', p4: '0',
          p5: '0', p6: '0', p7: '0', p8: '0', p9: '0',
          _isSelected: false
        },
        Z: {
          axisUnit: '公厘',
          programOrigin: '0',
          encoderProgramOrigin: '0',
          axisPulseUnit: '5000',
          encoderPulseUnit: '5000',
          speed: '100',
          backlash: '0',
          motorReverse: false,
          jogReverse: false,
          encoderReverse: false,
          limitLevel: '0',
          homeLevel: '0',
          indexLevel: '0',
          positionLevel: '0',
          accelTime: '0.1',
          accelMode: '梯形',
          initialSpeed: '0',
          posTimeout: '0',
          posDelay: '0',
          indexDelay: '0',
          externalHome: '無',
          externalPosJog: '無',
          externalNegJog: '無',
          homeSpeed: '50',
          leaveHomeSpeed: '25',
          homeReverse: false,
          homeLimitMode: '0',
          indexDirection: '不使用',
          limitStopMode: '0',
          homeOffset: '0',
          useSoftLimit: false,
          posLimit: '0',
          negLimit: '0',
          travel: '100',
          p0: '0', p1: '0', p2: '0', p3: '0', p4: '0',
          p5: '0', p6: '0', p7: '0', p8: '0', p9: '0',
          _isSelected: false
        },
        R: {
          axisUnit: '度',
          programOrigin: '0',
          encoderProgramOrigin: '0',
          axisPulseUnit: '5000',
          encoderPulseUnit: '5000',
          speed: '100',
          backlash: '0',
          motorReverse: false,
          jogReverse: false,
          encoderReverse: false,
          limitLevel: '0',
          homeLevel: '0',
          indexLevel: '0',
          positionLevel: '0',
          accelTime: '0.1',
          accelMode: '梯形',
          initialSpeed: '0',
          posTimeout: '0',
          posDelay: '0',
          indexDelay: '0',
          externalHome: '無',
          externalPosJog: '無',
          externalNegJog: '無',
          homeSpeed: '50',
          leaveHomeSpeed: '25',
          homeReverse: false,
          homeLimitMode: '0',
          indexDirection: '不使用',
          limitStopMode: '0',
          homeOffset: '0',
          useSoftLimit: false,
          posLimit: '0',
          negLimit: '0',
          travel: '360',
          p0: '0', p1: '0', p2: '0', p3: '0', p4: '0',
          p5: '0', p6: '0', p7: '0', p8: '0', p9: '0',
          _isSelected: false
        }
      };

      // 儲存共用參數的對象
      const commonParams = {
        compensationTable: '未使用',
        encoderCompensationTable: '未使用',
        minSpeed: '1.0',
        maxSpeed: '200.0',
        workEndPoint: '無',
        homeEndPoint: '無'
      };

      // 獲取所有軸參數輸入元素的ID
      function getAllAxisInputIds() {
        const inputs = document.querySelectorAll('.axis-panel input, .axis-panel select');
        const ids = [];
        inputs.forEach(input => {
          if (input.id) ids.push(input.id);
        });
        return ids;
      }

      // 獲取所有共用參數的ID
      function getAllCommonInputIds() {
        return ['compensationTable', 'encoderCompensationTable', 'minSpeed', 'maxSpeed', 'workEndPoint', 'homeEndPoint'];
      }

      // 保存當前軸參數設定
      function saveCurrentAxisParams() {
        const inputIds = getAllAxisInputIds();
        const currentParams = {};
        
        inputIds.forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            if (element.type === 'checkbox') {
              currentParams[id] = element.checked;
            } else {
              currentParams[id] = element.value;
            }
          }
        });
        
        return currentParams;
      }

      // 保存當前共用參數設定
      function saveCurrentCommonParams() {
        const inputIds = getAllCommonInputIds();
        const currentParams = {};
        
        inputIds.forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            if (element.type === 'checkbox') {
              currentParams[id] = element.checked;
            } else {
              currentParams[id] = element.value;
            }
          }
        });
        
        return currentParams;
      }

      // 載入軸參數到表單
      function loadAxisParams(params) {
        if (!params) return;
        
        for (const id in params) {
          // 跳過內部標記屬性
          if (id === '_isSelected') continue;
          
          const element = document.getElementById(id);
          if (element) {
            if (element.type === 'checkbox') {
              element.checked = params[id];
              // 如果是軟體極限的checkbox，需要觸發其onchange事件
              if (id === 'useSoftLimit') {
                document.getElementById('posLimit').disabled = !params[id];
                document.getElementById('negLimit').disabled = !params[id];
              }
            } else {
              element.value = params[id];
            }
          }
        }
      }

      // 載入共用參數到表單
      function loadCommonParams(params) {
        if (!params) return;
        
        for (const id in params) {
          const element = document.getElementById(id);
          if (element) {
            if (element.type === 'checkbox') {
              element.checked = params[id];
            } else {
              element.value = params[id];
            }
          }
        }
      }

      // 初始化時為每個軸添加選中狀態標記
      for (const axis in axisParams) {
        axisParams[axis]._isSelected = false;
      }

      // 初始化頁面時載入共用參數
      loadCommonParams(commonParams);

      // 監聽軸選擇變更
      document.querySelectorAll('input[name="axis"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          // 獲取當前選中的軸
          const checkedAxes = Array.from(document.querySelectorAll('input[name="axis"]:checked'))
            .map(cb => cb.value);
          
          // 更新所有軸的選中狀態
          for (const axis in axisParams) {
            const checkbox = document.querySelector(`input[name="axis"][value="${axis}"]`);
            if (checkbox) {
              axisParams[axis]._isSelected = checkbox.checked;
            }
          }
          
          // 如果有選中的軸，只在選擇最後一個軸時載入該軸的參數
          if (checkedAxes.length > 0) {
            // 獲取最後選中的軸（當前變更的軸）
            const lastSelectedAxis = this.value;
            
            // 只有當該軸被選中時才載入其參數
            if (this.checked) {
              loadAxisParams(axisParams[lastSelectedAxis]);
            } else {
              // 如果取消選中，則顯示剩餘選中的最後一個軸的參數
              if (checkedAxes.length > 0) {
                const lastAxis = checkedAxes[checkedAxes.length - 1];
                loadAxisParams(axisParams[lastAxis]);
              } else {
                // 如果沒有選中的軸，清空表單
                const emptyParams = {};
                getAllAxisInputIds().forEach(id => {
                  const element = document.getElementById(id);
                  if (element) {
                    if (element.type === 'checkbox') {
                      emptyParams[id] = false;
                    } else {
                      emptyParams[id] = '';
                    }
                  }
                });
                loadAxisParams(emptyParams);
              }
            }
          } else {
            // 如果沒有選中的軸，清空表單
            const emptyParams = {};
            getAllAxisInputIds().forEach(id => {
              const element = document.getElementById(id);
              if (element) {
                if (element.type === 'checkbox') {
                  emptyParams[id] = false;
                } else {
                  emptyParams[id] = '';
                }
              }
            });
            loadAxisParams(emptyParams);
          }
        });
      });

      // 套用按鈕點擊事件
      document.getElementById('applyBtn').addEventListener('click', function() {
        const checkedAxes = Array.from(document.querySelectorAll('input[name="axis"]:checked'))
          .map(cb => cb.value);
        
        if (checkedAxes.length === 0) {
          alert('請至少選擇一個軸');
          return;
        }
        
        const currentAxisParams = saveCurrentAxisParams();
        
        // 將當前軸參數保存到選中的每個軸
        checkedAxes.forEach(axis => {
          // 保留_isSelected屬性的值
          const isSelected = axisParams[axis]._isSelected;
          axisParams[axis] = {...currentAxisParams, _isSelected: isSelected};
        });
        
        // 保存共用參數
        Object.assign(commonParams, saveCurrentCommonParams());
        
        alert(`已套用參數到 ${checkedAxes.join(', ')} 軸`);
      });
    </script>

   
 

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
